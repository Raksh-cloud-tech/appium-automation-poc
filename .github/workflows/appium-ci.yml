- name: Verify environment
  run: |
    node -v
    npm -v
    java -version
    adb devices
    appium -v

- name: Start Appium Server
  run: |
    appium --log-level info &
    timeout /t 20

- name: Run Appium Tests
  run: npm run test:mobile

- name: Generate Allure Report
  if: always()
  run: |
    if (Test-Path allure-results) {
      allure generate allure-results --clean -o allure-report
    } else {
      Write-Host "No allure-results found"
    }

- name: Upload Allure Report
  if: always()
  uses: actions/upload-artifact@v4
  with:
    name: allure-report
    path: allure-report
